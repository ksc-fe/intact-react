(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?module.exports=t(require("react"),require("intact/dist"),require("react-dom")):typeof define==="function"&&define.amd?define(["react","intact/dist","react-dom"],t):e.Intact=t(e.React,e.Intact,e.ReactDOM)})(this,function(e,t,r){"use strict";e=e&&e.hasOwnProperty("default")?e["default"]:e;t=t&&t.hasOwnProperty("default")?t["default"]:t;r=r&&r.hasOwnProperty("default")?r["default"]:r;var n=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var i=function(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}};var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r){if(Object.prototype.hasOwnProperty.call(r,n)){e[n]=r[n]}}}return e};var s=function(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t};var u=function(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e};var p=function(){function e(t){var r=this;i(this,e);this.resolved=false;this.callbacks=[];t.call(this,function(){return r.resolve()})}e.prototype.resolve=function e(){this.resolved=true;var t=void 0;while(t=this.callbacks.shift()){t()}};e.prototype.then=function e(t){this.callbacks.push(t);if(this.resolved){this.resolve()}};return e}();p.all=function(e){var t=0;var r=e.callbacks||(e.callbacks=[]);var n=false;var i=false;e.forEach(function(e){if(e._hasRewrite)return;e._hasRewrite=true;e.then(s)});if(!e._hasRewrite){var o=e.push;e.push=function(t){t.then(s);o.call(e,t)};e.push.push=o;e._hasRewrite=true}function a(){e.length=0;e.push=e.push.push;e._hasRewrite=false;e.callbacks=[];var t=void 0;while(t=r.shift()){t()}}function s(){t++;if(e.length===t){n=true;if(i){return console.error("promise has done")}if(r.length){i=true;a()}}}return{then:function t(i){r.push(i);if(!e.length||n){a()}}}};var l=e.createElement;function c(e,t,r){var n=e.$$cid==="IntactReact";var i=e.propTypes;if(n&&i){e.propTypes=undefined}var o=l.apply(this,arguments);if(n&&i){e.propTypes=i}return o}e.createElement=c;var f=r.findDOMNode;r.findDOMNode=function(e){if(e instanceof Y){return e.element}return f.call(r,e)};var h=t.Vdt.miss;var d=h.h;h.h=function e(t){if(t&&t.$$cid==="IntactFunction"){t=t.$$type}for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++){n[i-1]=arguments[i]}return d.call.apply(d,[this,t].concat(n))};var _=t.utils;var v=_.isStringOrNumber;var y=_.isArray;var g=_.noop;function m(t){function r(e,r){if(r){var n=t(D(e,r,{instance:r.__parent}),true);if(y(n)){return n.map(function(e,t){return b(e,t)})}return b(n)}else{return t(e)}}r.contextTypes={_context:g,__parent:g};var n=e.forwardRef(function(e,t){if(t)e=a({},e,{forwardRef:t});return c(r,e)});n.$$cid="IntactFunction";n.$$type=r;return n}function b(e,t){if(v(e)){return e}else if(e){return c(e.tag,a({key:t},e.props),e.props.children||e.children)}}var C=/_ev[A-Z]/;var x=" react-mount-point-unstable ";var w=function(){function t(){i(this,t)}t.prototype.init=function e(t,r){this.destroyed=true;var n=this.placeholder=document.createComment(x);var i=this.parentDom;if(!i){var o=this.parentVNode;while(o){if(o.dom){i=o.dom;break}o=o.parentVNode}}if(i){i.appendChild(n);R(i)}this._render(r);return n};t.prototype.update=function e(t,r){this._render(r);return this.placeholder};t.prototype.destroy=function e(t,n,i){var o=this.placeholder;r.render(null,o,function(){var e=o.parentNode;Object.defineProperty(o,"parentNode",{value:e});e.removeChild(o)});o._unmount=g;if(o._realElement){o._realElement._unmount=g}};t.prototype._render=function t(n){var i=this._addProps(n);var o=this.placeholder;var a=n.props._parentRef.instance;if(a){if(!a._reactInternalFiber){a=a.get("_parentRef").instance}}else{var s=n.parentVNode;while(s){var u=s.children;if(u&&u._reactInternalFiber!==undefined){a=u;break}s=s.parentVNode}}var l=a.__providers;l.forEach(function(t,r){i=e.createElement(r,{value:t},i)});var c=new p(function(e){r.unstable_renderSubtreeIntoContainer(a,i,o,function(){var t=void 0;if(this){t=this.nodeType===3?this:r.findDOMNode(this)}else{t=o.previousSibling}o._realElement=t;t._placeholder=o;e()})});a.__promises.push(c)};t.prototype._addProps=function e(t){this.vdt={vNode:t};var r=t.props;var n=void 0;var i=void 0;for(var o in r){if(o==="reactVNode"||o==="_parentRef")continue;if(C.test(o))continue;if(!n){n=a({},r.reactVNode);i=n.props=a({},n.props)}var s=r[o];if(o.substr(0,3)==="ev-"){i[N[o]]=s}else{i[o]=s}}return n||r.reactVNode};return t}();var N={"ev-click":"onClick","ev-mouseenter":"onMouseEnter","ev-mouseleave":"onMouseLeave"};function R(e){if(!e._hasRewrite){var t=e.removeChild;e.removeChild=function(e){t.call(this,e._realElement||e);O(e)};var r=e.insertBefore;e.insertBefore=function(e,t){r.call(this,e,t&&t._realElement||t)};e._hasRewrite=true}}function O(e){var t=void 0;if(t=e._realElement){delete e._realElement;delete t._placeholder}else if(t=e._placeholder){delete e._placeholder;delete t._realElement}}var E=t.Vdt.miss;var k=E.h;var M=E.VNode;var V=E.Types;var Q=t.utils;var T=Q.isFunction;var $=Q.isArray;var j=Q.isStringOrNumber;var I=Q.set;var S=Q.get;function P(t,r){if(t==null)return t;if(j(t)){return new M(V.Text,null,null,t)}if(t instanceof M){if(T(t.tag)){t.props._parentRef=r}return t}var n=void 0;if((n=t.type)&&(n=n.$$cid)&&(n==="IntactReact"||n==="IntactFunction")){return k(t.type,D(a({},t.props,{_parentRef:r}),{_context:t._owner&&t._owner.stateNode},r,t.key),null,null,t.key,U(t.ref))}if(t.type===e.Fragment){return F(t.props.children,r)}return k(w,{reactVNode:t,_parentRef:r},null,t.props.className)}function F(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if($(e)){var r=[];e.forEach(function(e){if($(e)){r.push.apply(r,F(e,t))}else{r.push(P(e,t))}});return r}return P(e,t)}function D(e,t,r,n){if(!e)return;var i={};var o=i._blocks={};var a=void 0;for(var s in e){if(s==="children"){i.children=F(e.children,r)}else if(a=q(s)){i[a]=e[s]}else if(s.substring(0,2)==="b-"){o[s.substring(2)]=G(e[s])}else if(s==="forwardRef"){i.ref=e[s]}else{i[s]=e[s]}}i._context=A(t);if(n!=null){i.key=n}return i}function U(e){return(typeof e==="undefined"?"undefined":n(e))==="object"&&e!==null?function(t){e.current=t}:e}function A(e){var t=e._context;return{data:{get:function e(r){if(r!=null){return S(t.state||{},r)}else{return t.state||{}}},set:function e(r,n){var i=a({},t.state);I(i,r,n);t.setState(i)}}}}function G(e){if(T(e)){return function(t){for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++){n[i-1]=arguments[i]}return F(e.apply(this,n),{instance:this.data})}}else{return function(){return F(e,{instance:this.data})}}}function q(e){var t=e[0],r=e[1],n=e[2];if(!n)return;var i=void 0;if(t==="o"&&r==="n"){if(n==="$"){return"ev-$"+e.substring(3).replace(/\-/g,":")}else if((i=n.charCodeAt(0))&&i>=65&&i<=90){return"ev-"+e.substring(2).toLowerCase().replace(/\-/g,":")}}}var B=t.utils;var L=B.isObject;var W=B.extend;var z=t.Vdt.miss;var Z=z.h;var H=z.config;if(H){H.disableDelegate=true}var J=void 0;var K=void 0;var X=[];var Y=function(t){s(r,t);function r(e,n){i(this,r);if(n){var o={};var a=D(e,n,o);var s=u(this,t.call(this,a));o.instance=s;s.__promises=n.__promises||X;s.mountedQueue=n.__parent&&n.__parent.mountedQueue;s.vNode=Z(s.constructor,a);s.vNode.children=s;s._props=s.props;delete s.props;s._isReact=true}else{var s=u(this,t.call(this,e))}s._triggerFlagStack=[];var p=void 0;Object.defineProperty(s,"element",{get:function e(){if(!this.__isUpdating&&p&&p.nodeType===8&&p.nodeValue===x){return p._realElement||p}return p},set:function e(t){p=t},configurable:true,enumerable:true});return u(s)}r.prototype.getChildContext=function e(){return{__parent:this,__promises:this.__promises}};r.prototype.get=function e(){for(var r=arguments.length,n=Array(r),i=0;i<r;i++){n[i]=arguments[i]}if(this._isReact){var o;var a=this.props;this.props=this._props;var s=(o=t.prototype.get).call.apply(o,[this].concat(n));this.props=a;return s}else{var u;return(u=t.prototype.get).call.apply(u,[this].concat(n))}};r.prototype.set=function e(){for(var r=arguments.length,n=Array(r),i=0;i<r;i++){n[i]=arguments[i]}if(this._isReact){var o;var a=this.props;this.props=this._props;var s=(o=t.prototype.set).call.apply(o,[this].concat(n));this.props=a;return s}else{var u;return(u=t.prototype.set).call.apply(u,[this].concat(n))}};r.prototype.init=function e(r,n){var i=this.__isUpdating;this.__isUpdating=true;this.refs=this.vdt.widgets||{};this.__pushGetChildContext(n);var o=t.prototype.init.call(this,r,n);this.__popGetChildContext();this.__isUpdating=i;return o};r.prototype.update=function e(r,n,i){var o=this;var e=function e(){var a=o.__isUpdating;o.__isUpdating=true;var s=!a&&!o.__getChildContext;if(s){o.__pushGetChildContext(n||o.vNode)}var u=t.prototype.update.call(o,r,n,i);if(s){o.__popGetChildContext()}o.__isUpdating=a;return u};if(!this._isReact)return e();this.__initMountedQueue();var a=e();this.__triggerMountedQueue();return a};r.prototype.__pushGetChildContext=function e(t){var r=t&&t.props._parentRef;var n=r&&r.instance;if(n){var i=this;this.__getChildContext=n.getChildContext;n.getChildContext=function(){var e=i.__getChildContext.call(this);return a({},e,{__parent:i})}}this.__parentInstance=n};r.prototype.__popGetChildContext=function e(){if(this.__parentInstance){this.__parentInstance.getChildContext=this.__getChildContext;this.__getChildContext=null}};r.prototype.componentDidMount=function e(){var t=this;this.__initMountedQueue();this.inited=true;this.parentVNode=this.vNode.parentVNode=this.context.__parent&&this.context.__parent.vNode;var r=this.init(null,this.vNode);var n=this._placeholder;var i=n.parentElement;this.parentDom=i;r[J]=n[J];r[K]=n[K];Object.defineProperty(n,"parentNode",{value:i});i.replaceChild(r,n);n._realElement=r;R(i);this.mountedQueue.push(function(){t.mount()});this.__triggerMountedQueue()};r.prototype.componentWillUnmount=function e(){this.destroy()};r.prototype.componentDidUpdate=function e(){this.__initMountedQueue();var t=Z(this.constructor,D(this.props,this.context,{instance:this}));var r=this.vNode;t.children=this;this.vNode=t;this.parentVNode=t.parentVNode=this.context.__parent&&this.context.__parent.vNode;this.update(r,t);this.__triggerMountedQueue()};r.prototype.__ref=function e(t){this._placeholder=t;if(!J){var r=Object.keys(t);J=r[0];K=r[1]}};r.prototype.render=function t(){this.__providers=new Map;var r=this._reactInternalFiber;while(r=r.return){if(r.tag===10){var n=r.type;this.__providers.set(n,n._context._currentValue)}}return e.createElement("i",{ref:this.__ref})};r.prototype.__initMountedQueue=function e(){this._triggerFlagStack.push(this._shouldTrigger);this._shouldTrigger=false;if(!this.mountedQueue||this.mountedQueue.done){var t=void 0;if((t=this.context)&&(t=t.__parent)&&(t=t.mountedQueue)){if(!t.done){this.mountedQueue=t;return}}this._shouldTrigger=true;this._initMountedQueue()}};r.prototype.__triggerMountedQueue=function e(){var t=this;if(this._shouldTrigger){p.all(this.__promises).then(function(){X=[];t._triggerMountedQueue()})}this._shouldTrigger=this._triggerFlagStack.pop()};o(r,[{key:"isMounted",get:function e(){return this.mounted}}]);return r}(t);Y.functionalWrapper=m;Y.normalize=F;Y.$$cid="IntactReact";Y.prototype.isReactComponent={};Y.contextTypes={_context:g,__parent:g,__promises:g,router:g};Y.childContextTypes={__parent:g,__promises:g};if(!Object.setPrototypeOf){W(Y,t);if(!Y.template){Y.template=t.template}}return Y});