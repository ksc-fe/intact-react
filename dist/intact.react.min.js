(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?module.exports=e(require("react"),require("intact/dist"),require("react-dom")):typeof define==="function"&&define.amd?define(["react","intact/dist","react-dom"],e):t.Intact=e(t.React,t.Intact,t.ReactDOM)})(this,function(t,e,r){"use strict";t=t&&t.hasOwnProperty("default")?t["default"]:t;e=e&&e.hasOwnProperty("default")?e["default"]:e;r=r&&r.hasOwnProperty("default")?r["default"]:r;var n=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var o=function(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}};var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(t,n.key,n)}}return function(e,r,n){if(r)t(e.prototype,r);if(n)t(e,n);return e}}();var a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r){if(Object.prototype.hasOwnProperty.call(r,n)){t[n]=r[n]}}}return t};var s=function(t,e){if(typeof e!=="function"&&e!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof e)}t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:false,writable:true,configurable:true}});if(e)Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e};var u=function(t,e){if(!t){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e&&(typeof e==="object"||typeof e==="function")?e:t};var p=function(){function t(e){var r=this;o(this,t);this.resolved=false;this.callbacks=[];e.call(this,function(){return r.resolve()})}t.prototype.resolve=function t(){this.resolved=true;var e=void 0;while(e=this.callbacks.shift()){e()}};t.prototype.then=function t(e){this.callbacks.push(e);if(this.resolved){this.resolve()}};return t}();p.all=function(t){var e=0;var r=void 0;var n=false;var o=false;t.forEach(function(t){return t.then(s)});if(t._hasRewrite){console.error("promises has not been done")}var i=t.push;t.push=function(e){e.then(s);i.call(t,e)};t._hasRewrite=true;function a(){t.length=0;t.push=i;t._hasRewrite=false;r()}function s(){e++;if(t.length===e){n=true;if(o){return console.error("promise has done")}if(r){o=true;a()}}}return{then:function e(o){r=o;if(!t.length||n){a()}}}};var c=/_ev[A-Z]/;var l=function(){function t(){o(this,t)}t.prototype.init=function t(e,r){this.destroyed=true;this.placeholder=document.createComment(" react-mount-point-unstable ");this._render(r);return this.placeholder};t.prototype.update=function t(e,r){this._render(r);return this.placeholder};t.prototype.destroy=function t(){var e=this.placeholder;e._unmount=function(){r.render(null,e,function(){e.parentNode.removeChild(e)})}};t.prototype._render=function t(e){var n=this;var o=this._addProps(e);var i=e.props.parentRef.instance;if(i){if(!i._reactInternalFiber){i=i.get("parentRef").instance}}else{var a=e.parentVNode;while(a){var s=a.children;if(s&&s._reactInternalFiber!==undefined){i=s;break}a=a.parentVNode}}var u=new p(function(t){r.unstable_renderSubtreeIntoContainer(i,o,n.placeholder,function(){var n=r.findDOMNode(this);var o=e.parentVNode;while(o&&o.tag&&o.tag.$$cid==="IntactReact"){o.children.element=n;o=o.parentVNode}t()})});i.promises.push(u)};t.prototype._addProps=function t(e){this.vdt={vNode:e};var r=e.props;var n=void 0;var o=void 0;for(var i in r){if(i==="reactVNode"||i==="parentRef")continue;if(c.test(i))continue;if(!n){n=a({},r.reactVNode);o=n.props=a({},n.props)}var s=r[i];if(i.substr(0,3)==="ev-"){o[f[i]]=s}else{o[i]=s}}return n||r.reactVNode};return t}();var f={"ev-click":"onClick","ev-mouseenter":"onMouseEnter","ev-mouseleave":"onMouseLeave"};var h=t.createElement;function d(t,e,r){var n=t.$$cid==="IntactReact";var o=t.propTypes;if(n&&o){t.propTypes=undefined}var i=h.apply(this,arguments);if(n&&o){t.propTypes=o}return i}t.createElement=d;var v=r.findDOMNode;r.findDOMNode=function(t){if(t instanceof U){return t.element}return v.call(r,t)};var _=e.Vdt.miss;var y=_.h;var m=_.VNode;var g=e.utils;var b=g.isFunction;var C=g.isArray;var x=g.isStringOrNumber;var N=g.set;var w=g.get;function R(t,e){if(t==null)return t;if(x(t))return t;if(t instanceof m){if(t.tag===l){t.props.parentRef=e}return t}if(t.type&&t.type.$$cid==="IntactReact"){return y(t.type,M(a({},t.props,{parentRef:e}),{_context:t._owner&&t._owner.stateNode},e,t.key),null,null,t.key,Q(t.ref))}return y(l,{reactVNode:t,parentRef:e},null,t.props.className)}function O(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(C(t)){return t.map(function(t){return R(t,e)})}return R(t,e)}function M(t,e,r,n){if(!t)return;var o={};var i=o._blocks={};var a=void 0;for(var s in t){if(s==="children"){o.children=O(t.children,r)}else if(a=k(s)){o[a]=t[s]}else if(s.substring(0,2)==="b-"){i[s.substring(2)]=V(t[s])}else{o[s]=t[s]}}o._context=T(e);if(n!=null){o.key=n}return o}function Q(t){return(typeof t==="undefined"?"undefined":n(t))==="object"&&t!==null?function(e){t.current=e}:t}function T(t){var e=t._context;return{data:{get:function t(r){if(r!=null){return w(e.state||{},r)}else{return e.state||{}}},set:function t(r,n){var o=a({},e.state);N(o,r,n);e.setState(o)}}}}function V(t){if(b(t)){return function(e){for(var r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++){n[o-1]=arguments[o]}return O(t.apply(this,n),{instance:this.data})}}else{return function(){return O(t,{instance:this.data})}}}function k(t){var e=t[0],r=t[1],n=t[2];var o=void 0;if(e==="o"&&r==="n"){if(n==="$"){return"ev-$"+t.substring(3).replace(/\-/g,":")}else if((o=n.charCodeAt(0))&&o>=65&&o<=90){return"ev-"+t.substring(2).toLowerCase()}}}var I=e.utils;var j=I.isStringOrNumber;var E=I.isArray;var P=I.noop;function S(t){function e(e,r){if(r){var n=t(M(e,r,{}),true);if(E(n)){return n.map(function(t){return $(t)})}return $(n)}else{return t(e)}}e.contextTypes={_context:P};return e}function $(t){if(j(t)){return t}else if(t){return d(t.tag,t.props,t.props.children||t.children)}}var A=e.utils;var D=A.noop;var G=A.isArray;var F=A.isObject;var q=A.extend;var L=e.Vdt.miss.h;var U=function(e){s(r,e);function r(t,n){o(this,r);if(n){var i={};var a=M(t,n,i);var s=u(this,e.call(this,a));i.instance=s;s.promises=n.promises||[];s.mountedQueue=n.parent&&n.parent.mountedQueue;s.vNode=L(s.constructor,a);s.vNode.children=s;s._props=s.props;delete s.props;s._isReact=true}else{var s=u(this,e.call(this,t))}return u(s)}r.prototype.getChildContext=function t(){return{parent:this,promises:this.promises}};r.prototype.get=function t(){for(var r=arguments.length,n=Array(r),o=0;o<r;o++){n[o]=arguments[o]}if(this._isReact){var i;var a=this.props;this.props=this._props;var s=(i=e.prototype.get).call.apply(i,[this].concat(n));this.props=a;return s}else{var u;return(u=e.prototype.get).call.apply(u,[this].concat(n))}};r.prototype.set=function t(){for(var r=arguments.length,n=Array(r),o=0;o<r;o++){n[o]=arguments[o]}if(this._isReact){var i;var a=this.props;this.props=this._props;var s=(i=e.prototype.set).call.apply(i,[this].concat(n));this.props=a;return s}else{var u;return(u=e.prototype.set).call.apply(u,[this].concat(n))}};r.prototype.init=function t(r,n){this.__pushGetChildContext(n);var o=e.prototype.init.call(this,r,n);this.__popGetChildContext();return o};r.prototype.update=function t(r,n,o){var i=this;var t=function t(){i.__pushGetChildContext(n);var a=e.prototype.update.call(i,r,n,o);i.__popGetChildContext();return a};if(!this._isReact)return t();this.__initMountedQueue();var a=t();this.__triggerMountedQueue();return a};r.prototype.__pushGetChildContext=function t(e){var r=e&&e.props.parentRef;var n=r&&r.instance;if(n){var o=this;this.__getChildContext=n.getChildContext;n.getChildContext=function(){var t=o.__getChildContext.call(this);return a({},t,{parent:o})}}this.__parentInstance=n};r.prototype.__popGetChildContext=function t(){if(this.__parentInstance){this.__parentInstance.getChildContext=this.__getChildContext}};r.prototype.componentDidMount=function t(){var e=this;this.__initMountedQueue();this.inited=true;this.parentVNode=this.vNode.parentVNode=this.context.parent&&this.context.parent.vNode;var r=this.init(null,this.vNode);var n=this._placeholder.parentElement;n.replaceChild(r,this._placeholder);this._placeholder._realElement=r;if(!n._hasRewrite){var o=n.removeChild;n.removeChild=function(t){o.call(this,t._realElement||t)};n._hasRewrite=true}this.mountedQueue.push(function(){e.mount()});this.__triggerMountedQueue()};r.prototype.componentWillUnmount=function t(){this.destroy()};r.prototype.componentDidUpdate=function t(){this.__initMountedQueue();var e=L(this.constructor,M(this.props,this.context,{instance:this}));var r=this.vNode;e.children=this;this.vNode=e;this.parentVNode=e.parentVNode=this.context.parent&&this.context.parent.vNode;this.update(r,e);this.__triggerMountedQueue()};r.prototype.__ref=function t(e){this._placeholder=e};r.prototype.render=function e(){return t.createElement("i",{ref:this.__ref})};r.prototype.__initMountedQueue=function t(){this.__oldTriggerFlag=this._shouldTrigger;this._shouldTrigger=false;if(!this.mountedQueue||this.mountedQueue.done){var e=void 0;if((e=this.context)&&(e=e.parent)&&(e=e.mountedQueue)){if(!e.done){this.mountedQueue=e;return}}this._shouldTrigger=true;this._initMountedQueue()}};r.prototype.__triggerMountedQueue=function t(){var e=this;if(this._shouldTrigger){p.all(this.promises).then(function(){e._triggerMountedQueue()})}this._shouldTrigger=this.__oldTriggerFlag};i(r,[{key:"isMounted",get:function t(){return this.mounted}}]);return r}(e);U.functionalWrapper=S;U.normalize=O;U.$$cid="IntactReact";U.prototype.isReactComponent={};U.contextTypes={_context:D,parent:D,promises:D};U.childContextTypes={parent:D,promises:D};if(!Object.setPrototypeOf){q(U,e);if(!U.template){U.template=e.template}}return U});