(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?module.exports=e(require("react"),require("intact/dist"),require("react-dom")):typeof define==="function"&&define.amd?define(["react","intact/dist","react-dom"],e):t.Intact=e(t.React,t.Intact,t.ReactDOM)})(this,function(t,e,r){"use strict";t=t&&t.hasOwnProperty("default")?t["default"]:t;e=e&&e.hasOwnProperty("default")?e["default"]:e;r=r&&r.hasOwnProperty("default")?r["default"]:r;var n=function(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}};var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(t,n.key,n)}}return function(e,r,n){if(r)t(e.prototype,r);if(n)t(e,n);return e}}();var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r){if(Object.prototype.hasOwnProperty.call(r,n)){t[n]=r[n]}}}return t};var a=function(t,e){if(typeof e!=="function"&&e!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof e)}t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:false,writable:true,configurable:true}});if(e)Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e};var u=function(t,e){if(!t){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e&&(typeof e==="object"||typeof e==="function")?e:t};var s=function(){function t(e){var r=this;n(this,t);this.resolved=false;this.callback=undefined;e.call(this,function(){return r.resolve()})}t.prototype.resolve=function t(){this.resolved=true;this.callback&&this.callback()};t.prototype.then=function t(e){this.callback=e;if(this.resolved){this.callback()}};return t}();s.all=function(t){var e=t.length;var r=0;var n=void 0;t.forEach(function(t){t.then(function(){r++;if(e===r){n&&n()}})});return{then:function t(r){n=r;if(!e){n()}}}};var c=[];var p=[];function l(){p.push(c);c=[]}function f(){c=p.pop()}var h=function(){function t(){n(this,t)}t.prototype.init=function t(e,n){this.destroyed=true;var o=this._addProps(n);var i=document.createComment(" react-mount-point-unstable ");var a=new s(function(t){r.unstable_renderSubtreeIntoContainer(n.props.parentRef.instance,o,i,t)});c.push(a);this.placeholder=i;return i};t.prototype.update=function t(e,n){var o=this;var i=this._addProps(n);var a=new s(function(t){r.unstable_renderSubtreeIntoContainer(n.props.parentRef.instance,i,o.placeholder,t)});c.push(a);return this.placeholder};t.prototype.destroy=function t(){var e=this.placeholder;e._unmount=function(){r.render(null,e,function(){e.parentNode.removeChild(e)})}};t.prototype._addProps=function t(e){this.vdt={vNode:e};var r=e.props;var n=void 0;var o=void 0;for(var a in r){if(a==="reactVNode"||a==="parentRef")continue;if(!n){n=i({},r.reactVNode);o=n.props=i({},n.props)}var u=r[a];if(a.substr(0,3)==="ev-"){o[d[a]]=u}else{o[a]=u}}return n||r.reactVNode};return t}();var d={"ev-click":"onClick","ev-mouseenter":"onMouseEnter","ev-mouseleave":"onMouseLeave"};var v=t.createElement;function y(t,e,r){var n=t.$$cid==="IntactReact";var o=t.propTypes;if(n&&o){t.propTypes=undefined}var i=v.apply(this,arguments);if(n&&o){t.propTypes=o}return i}t.createElement=y;var _=e.Vdt.miss;var g=_.h;var m=_.VNode;var b=e.utils;var N=b.isFunction;var w=b.isArray;var R=b.isStringOrNumber;var O=b.set;var x=b.get;function C(t,e){if(t==null)return t;if(R(t))return t;if(t instanceof m){if(t.tag===h){t.props.parentRef=e}return t}if(t.type&&t.type.$$cid==="IntactReact"){return g(t.type,M(t.props,{_context:t._owner.stateNode}),null,null,t.key,t.ref)}return g(h,{reactVNode:t,parentRef:e})}function T(t,e){if(w(t)){return t.map(function(t){return C(t,e)})}return C(t,e)}function M(t,e,r){if(!t)return;var n={};var o=n._blocks={};var i=void 0;for(var a in t){if(a==="children"){n.children=T(t.children,r)}else if(i=E(a)){n[i]=t[a]}else if(a.substring(0,2)==="b-"){o[a.substring(2)]=k(t[a])}else{n[a]=t[a]}}n._context=Q(e);return n}function Q(t){var e=t._context;return{data:{get:function t(r){if(r!=null){return x(e.state,r)}else{return e.state}},set:function t(r,n){var o=i({},e.state);O(o,r,n);e.setState(o)}}}}function k(t){if(N(t)){return function(e){for(var r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++){n[o-1]=arguments[o]}return T(t.apply(this,n),{instance:this.data})}}else{return function(){return T(t,{instance:this.data})}}}function E(t){var e=t[0],r=t[1],n=t[2];var o=void 0;if(e==="o"&&r==="n"){if(n==="$"){return"ev-$"+t.substring(3).replace(/\-/g,":")}else if((o=n.charCodeAt(0))&&o>=65&&o<=90){return"ev-"+t.substring(2).toLowerCase()}}}var V=e.utils;var P=V.isStringOrNumber;var j=V.isArray;function $(t){function e(e,r){if(r){var n=t(M(e,r,{}),true);if(j(n)){return n.map(function(t){return A(t)})}return A(n)}else{return t(e)}}return e}function A(t){if(P(t)){return t}else if(t){return y(t.tag,t.props,t.props.children||t.children)}}var I=e.utils;var S=I.noop;var q=I.isArray;var D=I.isObject;var L=e.Vdt.miss.h;var U=void 0;var W=function(e){a(r,e);function r(t,o){n(this,r);if(o){var i={};var a=M(t,o,i);var s=u(this,e.call(this,a));i.instance=s;s.vNode=L(s.constructor,a);s._props=s.props;delete s.props;s._isReact=true}else{var s=u(this,e.call(this,t))}return u(s)}r.prototype.getChildContext=function t(){return{parent:this}};r.prototype.get=function t(){for(var r=arguments.length,n=Array(r),o=0;o<r;o++){n[o]=arguments[o]}if(this._isReact){var i;var a=this.props;this.props=this._props;var u=(i=e.prototype.get).call.apply(i,[this].concat(n));this.props=a;return u}else{var s;return(s=e.prototype.get).call.apply(s,[this].concat(n))}};r.prototype.set=function t(){for(var r=arguments.length,n=Array(r),o=0;o<r;o++){n[o]=arguments[o]}if(this._isReact){var i;var a=this.props;this.props=this._props;var u=(i=e.prototype.set).call.apply(i,[this].concat(n));this.props=a;return u}else{var s;return(s=e.prototype.set).call.apply(s,[this].concat(n))}};r.prototype.componentDidMount=function t(){var e=this;var r=this._shouldTrigger;this.__initMountedQueue();this.inited=true;this.parentVNode=this.vNode.parentVNode=this.context.parent&&this.context.parent.vNode;var n=this.init(null,this.vNode);var o=this._placeholder.parentElement;o.replaceChild(n,this._placeholder);this._placeholder._realElement=n;if(!o._hasRewrite){var i=o.removeChild;o.removeChild=function(t){i.call(this,t._realElement||t)};o._hasRewrite=true}this.mountedQueue.push(function(){e.mount()});this.__triggerMountedQueue();this._shouldTrigger=r};r.prototype.componentWillUnmount=function t(){this.destroy()};r.prototype.componentDidUpdate=function t(){var e=this._shouldTrigger;this.__initMountedQueue();var r=L(this.constructor,M(this.props,this.context,{instance:this}));var n=this.vNode;r.children=this;this.vNode=r;this.parentVNode=r.parentVNode=this.context.parent&&this.context.parent.vNode;this.update(n,r);this.__triggerMountedQueue();this._shouldTrigger=e};r.prototype.__ref=function t(e){this._placeholder=e};r.prototype.render=function e(){return t.createElement("i",{ref:this.__ref})};r.prototype.__initMountedQueue=function t(){this._shouldTrigger=false;if(!U||U.done){this._shouldTrigger=true;if(!this.mountedQueue||this.mountedQueue.done){this._initMountedQueue()}U=this.mountedQueue;l()}else{this.mountedQueue=U}};r.prototype.__triggerMountedQueue=function t(){var e=this;if(this._shouldTrigger){s.all(c).then(function(){e._triggerMountedQueue();U=null;e._shouldTrigger=false;f()})}};o(r,[{key:"isMounted",get:function t(){return this.mounted}}]);return r}(e);W.functionalWrapper=$;W.$$cid="IntactReact";W.prototype.isReactComponent={};W.contextTypes={_context:S,parent:S};W.childContextTypes={parent:S};return W});